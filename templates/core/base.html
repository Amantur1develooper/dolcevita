{% load static %}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% block title %}Dolce Vita Family — italian restaurant{% endblock %}</title>
  <meta name="description" content="{% block meta_description %}Аутентичная итальянская кухня: пицца из печи, паста, салаты. Быстрый заказ в WhatsApp.{% endblock %}">
  <meta name="theme-color" content="#128148">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon.png' %}">
  <link rel="apple-touch-icon" href="{% static 'img/favicon.png' %}">
  <link rel="shortcut icon" href="{% static 'img/favicon.png' %}">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Шрифты -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{ --green:#009246; --white:#ffffff; --red:#ce2b37; --ink:#1f1f1f; --paper:#f5f3ef; }
    html,body{ height:100%; color:var(--ink); }
    /* Бумажная текстура */
    body{
      background:
        radial-gradient(circle at 12% 18%, rgba(0,0,0,.025) 0 40%, transparent 41%) 0 0/26px 26px,
        radial-gradient(circle at 70% 70%, rgba(0,0,0,.02) 0 40%, transparent 41%) 10px 10px/22px 22px,
        var(--paper);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .brand{ font-family:"Cormorant Garamond", serif; letter-spacing:.02em; }
    .flag-x{ background:linear-gradient(90deg, var(--green) 0 33%, var(--white) 33% 66%, var(--red) 66% 100%); }
    .flag-y{ background:linear-gradient(180deg, var(--green) 0 33%, var(--white) 33% 66%, var(--red) 66% 100%); }
    /* Убираем синий тап-хайлайт на мобилках */
    a,button{ -webkit-tap-highlight-color: transparent; }
  </style>

  {% block head_extra %}{% endblock %}
</head>
<body>

  <!-- ШАПКА -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-black/5">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="{% url 'core:home' %}" class="flex items-center gap-3">
        <!-- Если есть файл логотипа — покажи -->
        <!-- <img src="{% static 'img/dolcevita-logo.png' %}" class="h-8 w-auto hidden sm:block" alt="Dolce Vita"> -->
        <div class="brand text-2xl sm:text-3xl font-semibold italic">Dolce <span class="font-bold not-italic">Vita</span> Family</div>
      </a>

      <nav class="hidden sm:flex items-center gap-5 text-sm text-stone-700">
        <a href="{% url 'core:home' %}" class="hover:text-black">Меню</a>
        <a href="{% url 'core:about' %}" class="hover:text-black">О нас</a>
        <a href="{% url 'core:contacts' %}" class="hover:text-black">Контакты</a>
      </nav>

      <a href="{% url 'core:cart_detail' %}" class="relative inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-emerald-600 text-white font-semibold shadow">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2Zm10 0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2ZM7.17 14h9.66c.75 0 1.41-.41 1.75-1.03l3.58-6.49A1 1 0 0 0 21.33 5H6.21L5.27 3H2v2h2l3.6 7.59-1.35 2.45C5.52 15.37 6.02 16 6.7 16H20v-2H7.42l.75-1.35Z"/></svg>
        {% if cart_count %}
    <span id="cart-badge" class="absolute -top-2 -right-2 text-xs bg-red-600 text-white rounded-full px-1.5 py-0.5">{{ cart_count }}</span>
  {% else %}
    <span id="cart-badge" class="hidden absolute -top-2 -right-2 text-xs bg-red-600 text-white rounded-full px-1.5 py-0.5">0</span>
  {% endif %}
  <span class="hidden sm:inline">Корзина</span>
</a>
    </div>
    <div class="flag-x h-1 w-full"></div>
  </header>

  <!-- HERO (опционально переопределяем) -->
  {% block hero %}
  <section class="max-w-6xl mx-auto px-4 pt-6">
    <div class="rounded-3xl bg-white/80 backdrop-blur shadow-xl ring-1 ring-black/5 p-5 md:p-8 flex items-center gap-5">
      <div>
        <div class="brand text-3xl md:text-5xl font-semibold leading-tight">Sapori d’Italia</div>
        <div class="text-stone-600 mt-1">Печь на дровах, свежая паста, салаты и десерты. Сбор заказа — в WhatsApp.</div>
        <div class="flag-x h-1 w-28 mt-3 rounded-full"></div>
      </div>
    </div>
  </section>
  {% endblock %}

  <!-- ОСНОВНОЙ КОНТЕНТ -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    {% block content %}{% endblock %}
  </main>

  <!-- Плавающая кнопка (ведёт в корзину/чекаут) -->
  <a href="{% url 'core:cart_detail' %}"
     class="fixed right-4 bottom-4 z-50 inline-flex items-center gap-2 px-4 py-3 rounded-full text-white font-semibold shadow-xl"
     style="background:#25D366">
     <!-- иконка whatsapp -->
     <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 32 32" fill="currentColor"><path d="M19.11 17.34c-.28-.14-1.62-.8-1.87-.9-.25-.09-.43-.14-.61.14-.18.27-.7.9-.86 1.08-.16.18-.32.2-.6.07-.28-.14-1.19-.44-2.27-1.4-.84-.75-1.41-1.68-1.57-1.96-.16-.27-.02-.42.12-.56.12-.12.28-.32.42-.48.14-.16.18-.27.28-.45.09-.18.05-.34-.02-.48-.07-.14-.61-1.46-.83-2-.22-.53-.44-.46-.61-.47-.16-.01-.34-.01-.52-.01-.18 0-.48.07-.73.34-.25.27-.96.94-.96 2.28 0 1.34.99 2.63 1.13 2.8.14.18 1.95 2.98 4.72 4.18.66.28 1.18.45 1.58.57.66.21 1.26.18 1.73.11.53-.08 1.62-.66 1.85-1.3.23-.64.23-1.2.16-1.31-.07-.11-.25-.18-.53-.32z"/><path d="M26.66 5.34C23.79 2.48 20.03 1 16 1 7.72 1 1 7.72 1 16c0 2.64.69 5.22 2 7.49L1 31l7.69-1.97A14.87 14.87 0 0 0 16 31c8.28 0 15-6.72 15-15 0-4.03-1.48-7.79-4.34-10.66zM16 28.33c-2.47 0-4.88-.66-6.98-1.92l-.5-.3-4.56 1.17 1.22-4.45-.33-.52A12.29 12.29 0 0 1 3.67 16c0-6.81 5.52-12.33 12.33-12.33 3.29 0 6.38 1.28 8.71 3.61a12.24 12.24 0 0 1 3.62 8.72c0 6.81-5.53 12.33-12.33 12.33z"/></svg>
     Заказать в WhatsApp
  </a>

  <!-- ФУТЕР -->
<footer class="mt-10 border-t border-black/5 bg-white/70 backdrop-blur">
  <div class="flag-x h-1 w-full"></div>
  <div class="max-w-6xl mx-auto px-4 py-6 text-sm text-stone-600">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
      <div>© Dolce Vita Family, {% now "Y" %}</div>
      <div class="text-stone-500">Пицца из печи · Паста · Десерты</div>
    </div>
  </div>
</footer>
<div id="toast" class="hidden fixed left-1/2 -translate-x-1/2 bottom-24 z-50">
  <div class="bg-black text-white px-4 py-2 rounded-full shadow-xl">Добавлено в корзину</div>
</div>

{% block scripts %}
<script>
  // делегирование submit только для форм с data-add-to-cart
  document.addEventListener('submit', async (e) => {
    const f = e.target;
    if (!f.matches('form[data-add-to-cart]')) return;

    e.preventDefault();

    // готовим запрос
    const csrf = f.querySelector('input[name=csrfmiddlewaretoken]')?.value || '';
    const res = await fetch(f.action, {
      method: 'POST',
      headers: {
        'X-Requested-With': 'XMLHttpRequest',
        'X-CSRFToken': csrf,
      },
      body: new FormData(f),
    });

    if (!res.ok) {
      // если сервер не вернул JSON, просто fallback — обычная отправка
      f.submit();
      return;
    }

    const data = await res.json();
    // обновляем бейдж
    const badge = document.getElementById('cart-badge');
    if (badge) {
      badge.textContent = data.count ?? data.items_count ?? '0';
      badge.classList.remove('hidden');
    }
    // показываем тост
    const t = document.getElementById('toast');
    if (t) {
      t.classList.remove('hidden');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>t.classList.add('hidden'), 1400);
    }
  });
</script>
{% endblock %}

</body>
</html>
